* Micro Focus COBOL                  V8.0 revision 000 19-Jun-23 21:33 Page   1
* /home/oracle/Westpac/prod/cobol/logon.cob
* Directives File: /home/oracle/Westpac/prod/bin/logon.cob.dir
* Accepted - showdir
* Accepted - P(cobsql)
* Accepted - INT"/home/oracle/Westpac/prod/bin/"
* Accepted - ANIM
* Accepted - LISTPATH"/home/oracle/Westpac/prod/Listing"
* Accepted - ERRFORMAT(2)
* Accepted - STDERR
* End Of Directives File: /home/oracle/Westpac/prod/bin/logon.cob.dir
     1 IDENTIFICATION DIVISION.
     2 PROGRAM-ID. LOGON.
     3 ENVIRONMENT DIVISION.
     4 DATA DIVISION.
     5 WORKING-STORAGE SECTION.
     6     EXEC SQL BEGIN DECLARE SECTION END-EXEC.
     7 01 USERNAME PIC X(10) varying.
     8 01 PASSWD PIC X(10) varying.
     9 01 EMP-REC-VARS.
    10   05 EMP-NAME PIC X(10) VARYING.
    11   05 EMP-NUMBER PIC S9(4) COMP VALUE ZERO.
    12   05 SALARY PIC S9(5)V99 COMP-3 VALUE ZERO.
    13   05 COMMISSION PIC S9(5)V99 COMP-3 VALUE ZERO.
    14   05 COMM-IND PIC S9(4) COMP VALUE ZERO.
    15     EXEC SQL END DECLARE SECTION END-EXEC.
    16     EXEC SQL INCLUDE SQLCA END-EXEC.
    17 01 DISPLAY-VARIABLES.
    18   05 D-EMP-NAME PIC X(10).
    19   05 D-SALARY PIC Z(4)9.99.
    20   05 D-COMMISSION PIC Z(4)9.99.
    21 01 D-TOTAL-QUERIED PIC 9(4) VALUE ZERO.
    22
    23 01 ws-flags pic x(4) comp-5 value 1.
    24 01 ws-timeout pic s9(18) comp-5 value 0.
    25 01 ws-identifier PIC x(4) VALUE "HELP".
    26 01 ws-status-code pic x(4) comp-5 value zero.
    27
    28 PROCEDURE DIVISION.
    29 BEGIN-PGM SECTION.
    30
    31    CALL"CBL_DEBUG_START" using  by value ws-flags
    32                                         ws-timeout
    33                        by reference     ws-identifier
    34                        returning        ws-status-code
    35
    36     ACCEPT EMP-NUMBER
    37     EXEC SQL
    38         WHENEVER SQLERROR DO PERFORM SQL-ERROR
    39     END-EXEC
    40     .
    41     PERFORM LOGON
    42     .
    43     PERFORM QUERY-LOOP
    44     .
    45     perform SIGN-OFF
    46     .
    47     goback
    48     .
    49
* Micro Focus COBOL                  V8.0 revision 000 19-Jun-23 21:33 Page   2
* /home/oracle/Westpac/prod/cobol/logon.cob
    50 LOGON SECTION.
    51
    52     MOVE "mfuser" TO USERNAME-ARR
    53     .
    54     MOVE 6 TO USERNAME-LEN
    55     .
    56     MOVE "Welcome01" TO PASSWD-ARR
    57
    58     MOVE 9 TO PASSWD-LEN
    59     .
    60
    61     EXEC SQL
    62         CONNECT :USERNAME IDENTIFIED BY :PASSWD
    63     END-EXEC
    64     .
    65     perform DISPLAY-INFO
    66
    67     DISPLAY " "
    68     .
    69     DISPLAY "EMPLOYEE    SALARY    COMMISSION" upon console
    70     .
    71     DISPLAY "--------    ------    ----------" upon console
    72     .
    73
    74 LOGON-EXIT.
    75     EXIT
    76     .
    77
    78 QUERY-LOOP SECTION.
    79     DISPLAY " "  upon console
    80     .
    81     DISPLAY "ENTER EMP NUMBER (0 TO QUIT): "  upon console
    82     .
    83
    84     ACCEPT EMP-NUMBER
    85     IF (EMP-NUMBER = 0)
    86         PERFORM SIGN-OFF
    87     END-IF
    88     .
    89
    90     perform until EMP-NUMBER = 0
    91
    92         perform get-employee-info
    93         DISPLAY " "  upon console
    94         DISPLAY "ENTER EMP NUMBER (0 TO QUIT): "   upon console
    95         ACCEPT EMP-NUMBER
    96
    97     end-perform.
    98
    99 QUERY-LOOP-exit.
   100       exit.
   101     .
   102
   103 get-employee-info section.
   104
   105     MOVE SPACES TO EMP-NAME-ARR
   106     .
   107
* Micro Focus COBOL                  V8.0 revision 000 19-Jun-23 21:33 Page   3
* /home/oracle/Westpac/prod/cobol/logon.cob
   108     .
   109
   110      EXEC SQL
   111         SELECT ENAME, SAL, COMM
   112         INTO :EMP-NAME, :SALARY, :COMMISSION:COMM-IND
   113         FROM EMP
   114         WHERE EMPNO = :EMP-NUMBER
   115      END-EXEC
   116     .
   117     if sqlcode = 0
   118         PERFORM DISPLAY-LINE
   119     else
   120         DISPLAY "NOT A VALID EMPLOYEE NUMBER - TRY AGAIN."
   121     end-if
   122     .
   123     ADD 1 TO D-TOTAL-QUERIED.
   124
   125 get-employee-info-EXIT.
   126     EXIT
   127     .
   128
   129 SIGN-OFF SECTION.
   130     DISPLAY " "
   131     .
   132
   133     DISPLAY "TOTAL NUMBER QUERIED WAS ", D-TOTAL-QUERIED, "."
   134     .
   135     DISPLAY "HAVE A GOOD DAY."
   136     .
   137     DISPLAY " "
   138     .
   139     EXEC SQL
   140         COMMIT WORK RELEASE
   141     END-EXEC
   142     .
   143     GOBACK.
   144     .
   145
   146 SQL-ERROR SECTION.
   147     EXEC SQL
   148         WHENEVER SQLERROR CONTINUE
   149     END-EXEC
   150     .
   151     DISPLAY " "
   152     .
   153     DISPLAY "ORACLE ERROR DETECTED:"
   154     .
   155     DISPLAY " "
   156     .
   157     DISPLAY SQLERRMC
   158     .
   159     EXEC SQL
   160         ROLLBACK WORK RELEASE
   161     END-EXEC
   162     .
   163     STOP RUN
   164     .
   165
* Micro Focus COBOL                  V8.0 revision 000 19-Jun-23 21:33 Page   4
* /home/oracle/Westpac/prod/cobol/logon.cob
   166 DISPLAY-INFO SECTION.
   167
   168     DISPLAY " " upon console
   169     .
   170     DISPLAY "CONNECTED TO ORACLE AS USER    = " USERNAME upon
   171       console
   172     .
   173     DISPLAY "CONNECTED TO ORACLE AS PASSWORD=" PASSWD upon
   174       console
   175     .
   176     Display "SQLCODE = " SQLCODE
   177     .
   178 DISPLAY-INFO-EXIT.
   179     EXIT
   180     .
   181
   182 DISPLAY-LINE SECTION.
   183
   184     MOVE EMP-NAME-ARR TO D-EMP-NAME
   185     .
   186     MOVE SALARY TO D-SALARY
   187     .
   188     IF COMM-IND = -1
   189         DISPLAY D-EMP-NAME, D-SALARY, "          NULL"
   190     ELSE
   191         MOVE COMMISSION TO D-COMMISSION
   192         DISPLAY D-EMP-NAME, D-SALARY, "      ", D-COMMISSION
   193     END-IF
   194     .
   195     .
   196 DISPLAY-LINE-EXIT.
   197     EXIT
   198     .
   198*Statistics
   198*----------
   198*Return code: 0
   198*Number of messages at severity I: 0
   198*Number of messages at severity W: 0
   198*Number of messages at severity E: 0
   198*Number of messages at severity F: 0
   198*Number of input lines: 198
   198*Number of host variables declared: 17
   198*Number of cursor names: 0
   198*Number of statement names: 0
   198*Maximum memory (bytes) used: 1018779
* Micro Focus COBOL                  V8.0 revision 000 Compiler
* (C) Copyright 1984-2023 Micro Focus or one of its affiliates.
*                                                        REF GNR-085800000AM
* Total Messages:     0
* Data:        1760     Code:        3195
